<!DOCTYPE html>
<html>
<head>
  <title>Gráfico de Frequência da Voz</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Frequência da Voz</h1>
  <input type="text" id="syllableInput" placeholder="Digite sílabas sem vírgulas">
  <button onclick="speakSyllables()">Ler</button>
  <label for="volumeInput">Volume:</label>
  <input type="number" id="volumeInput" min="0" max="10" step="0.1" value="5">
  <label for="speedInput">Velocidade:</label>
  <input type="number" id="speedInput" min="1" max="10" value="5">
  <label for="pauseInput">Pausa (ms):</label>
  <input type="number" id="pauseInput" min="500" max="5000" step="100" value="2000">
  <button onclick="updateVolume()">Atualizar Volume</button>
  <button onclick="generateChart()">Gerar Gráfico</button>
  <button onclick="clearChart()">Limpar Gráfico</button>
  <canvas id="voiceChart"></canvas>
  
  <script>
    let frequencyData = [];
    let chart;
    let syllables = [];

    function speakSyllables() {
      // Obtém o valor das sílabas inseridas no campo de texto
      let syllableInput = document.getElementById("syllableInput").value.toLowerCase();
      
      // Remove as vírgulas da entrada
      syllables = syllableInput.replace(/,/g, "").split(" ").map(s => s.trim());
      
      // Verifica se o navegador suporta a síntese de voz
      if ('speechSynthesis' in window) {
        // Inicia a leitura das sílabas
        speakSyllable(0);
      } else {
        console.log("O navegador não suporta a síntese de voz.");
      }
    }
    
    function speakSyllable(index) {
      if (index >= syllables.length) {
        // Todas as sílabas foram lidas, encerra a função
        return;
      }
      
      // Obtém a sílaba atual
      let syllable = syllables[index];
      
      // Cria um objeto SpeechSynthesisUtterance com a sílaba a ser lida
      let utterance = new SpeechSynthesisUtterance(syllable);
      
      // Obtém o valor do volume do campo de entrada
      let volume = parseFloat(document.getElementById("volumeInput").value);
      
      // Obtém o valor da velocidade do campo de entrada
      let speed = parseFloat(document.getElementById("speedInput").value);
      
      // Define o volume e a velocidade da síntese de voz
      utterance.volume = volume / 10;
      utterance.rate = speed;
      
      // Inicia a síntese de voz da sílaba atual
      window.speechSynthesis.speak(utterance);
      
      // Calcula a frequência da sílaba e adiciona ao array
      let frequency = syllable.length;
      frequencyData.push(frequency);
      
      // Obtém o valor do tempo de pausa do campo de entrada
      let pauseTime = parseInt(document.getElementById("pauseInput").value);
      
      // Chama a função para ler a próxima sílaba após o tempo de pausa
      setTimeout(function() {
        speakSyllable(index + 1);
      }, pauseTime);
    }
    
    function updateVolume() {
      // Obtém o valor do volume do campo de entrada
      let volume = parseFloat(document.getElementById("volumeInput").value);
      
      // Atualiza o gráfico com o volume atual
      frequencyData.push(volume);
    }
    
    function generateChart() {
      // Configura o gráfico
      let ctx = document.getElementById("voiceChart").getContext("2d");
      chart = new Chart(ctx, {
        type: "line", // Alterado para o tipo de gráfico "line"
        data: {
          labels: Array.from({ length: frequencyData.length }, (_, i) => i + 1),
          datasets: [{
            label: "Frequência da Voz",
            data: frequencyData,
            backgroundColor: "rgba(75, 192, 192, 0.5)",
            borderColor: "rgba(75, 192, 192, 1)",
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              display: true,
              title: {
                display: true,
                text: "Leitura"
              }
            },
            y: {
              display: true,
              title: {
                display: true,
                text: "Frequência"
              },
              suggestedMin: 0
            }
          }
        }
      });
    }
    
    function clearChart() {
      // Limpa os dados do gráfico e atualiza
      frequencyData = [];
      chart.data.datasets[0].data = frequencyData;
      chart.update();
    }
  </script>
</body>
</html>
