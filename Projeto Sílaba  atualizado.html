<!DOCTYPE html>
<html>
<head>
  <title>Gráfico de Frequência da Voz</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background-color: LightSkyBlue;
      color: white;
    }
  </style>
</head>
<body>
  <h1>Projeto BÁ - DI</h1>
  <input type="text" id="syllableInput" placeholder="Digite sílabas sem vírgulas">
  <button onclick="speakSyllables()">Ler</button>
  <label for="volumeInput">Volume:</label>
  <input type="number" id="volumeInput" min="0" max="10" step="0.1" value="5">
  <label for="speedInput">Velocidade:</label>
  <input type="number" id="speedInput" min="1" max="10" value="5">
  <label for="pauseInput">Pausa (ms):</label>
  <input type="number" id="pauseInput" min="500" max="5000" step="100" value="2000">
  <button onclick="updateVolume()">Atualizar Volume</button>
  <button onclick="generateChart()">Gerar Gráfico</button>
  <button onclick="clearChart()">Limpar Gráfico</button>
  <canvas id="voiceChart"></canvas>

  <script>
    let frequencyData = [];
    let chart;
    let syllables = [];

    function speakSyllables() {
      let syllableInput = document.getElementById("syllableInput").value.toLowerCase();
      syllables = syllableInput.replace(/,/g, "").split(" ").map(s => s.trim());
      
      if ('speechSynthesis' in window) {
        speakSyllable(0);
      } else {
        console.log("O navegador não suporta a síntese de voz.");
      }
    }
    
    function speakSyllable(index) {
      if (index >= syllables.length) {
        return;
      }
      
      let syllable = syllables[index];
      let utterance = new SpeechSynthesisUtterance(syllable);
      
      let volume = parseFloat(document.getElementById("volumeInput").value);
      let speed = parseFloat(document.getElementById("speedInput").value);
      
      utterance.volume = volume / 10;
      utterance.rate = speed;
      
      window.speechSynthesis.speak(utterance);
      
      let frequency = syllable.length;
      frequencyData.push(frequency);
      
      let pauseTime = parseInt(document.getElementById("pauseInput").value);
      
      setTimeout(function() {
        speakSyllable(index + 1);
      }, pauseTime);
    }
    
    function updateVolume() {
      let volume = parseFloat(document.getElementById("volumeInput").value);
      frequencyData.push(volume);
    }
    
    function generateChart() {
      let ctx = document.getElementById("voiceChart").getContext("2d");
      
      if (chart) {
        chart.destroy();
      }
      
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: Array.from({ length: frequencyData.length }, (_, i) => i + 1),
          datasets: [{
            label: "Projeto BÁ - DI",
            data: frequencyData,
            backgroundColor: "LightSkyBlue",
            borderColor: "red",
            borderWidth: 3
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              display: true,
              grid: {
                color: "white"
              },
              title: {
                display: true,
                text: "Leitura"
              }
            },
            y: {
              display: true,
              grid: {
                color: "white"
              },
              title: {
                display: true,
                text: "Frequência"
              },
              suggestedMin: 0
            }
          }
        }
      });
    }
    
    function clearChart() {
      frequencyData = [];
      if (chart) {
        chart.data.datasets[0].data = frequencyData;
        chart.update();
      }
    }
  </script>
</body>
</html>
